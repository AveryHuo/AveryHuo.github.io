<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>GEA-P2 | Avery的城堡</title><meta name="keywords" content="Game"><meta name="author" content="霍家鹏"><meta name="copyright" content="霍家鹏"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1 介绍 (1.6) Runtime Engine Architecture   自底向上的顺序大概为： 硬件层 驱动层 系统层 ＳＤＫ层 ＞平台独立层 核心库 资源库 　渲染，调试，物理检测，游戏平台基础 ＞游戏级渲染，各上层动画机制，相机机制，ＡＩ机制 ＞游戏逻辑层  操作系统层 分为PC与主机（游戏）系统，PC系统如windows 提供了一种线程的机制为分享硬件资源，而主机游戏一般来说则可占">
<meta property="og:type" content="article">
<meta property="og:title" content="GEA-P2">
<meta property="og:url" content="http://www.hjp.wiki/2022/05/19/GEA_P2/index.html">
<meta property="og:site_name" content="Avery的城堡">
<meta property="og:description" content="1 介绍 (1.6) Runtime Engine Architecture   自底向上的顺序大概为： 硬件层 驱动层 系统层 ＳＤＫ层 ＞平台独立层 核心库 资源库 　渲染，调试，物理检测，游戏平台基础 ＞游戏级渲染，各上层动画机制，相机机制，ＡＩ机制 ＞游戏逻辑层  操作系统层 分为PC与主机（游戏）系统，PC系统如windows 提供了一种线程的机制为分享硬件资源，而主机游戏一般来说则可占">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.hjp.wiki/img/1574738644796.png">
<meta property="article:published_time" content="2022-05-19T13:28:29.000Z">
<meta property="article:modified_time" content="2022-05-19T13:28:29.000Z">
<meta property="article:author" content="霍家鹏">
<meta property="article:tag" content="Game">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.hjp.wiki/img/1574738644796.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.hjp.wiki/2022/05/19/GEA_P2/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 霍家鹏","link":"链接: ","source":"来源: Avery的城堡","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'GEA-P2',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-19 21:28:29'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/my.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">88</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Avery的城堡</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">GEA-P2</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-19T13:28:29.000Z" title="发表于 2022-05-19 21:28:29">2022-05-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-19T13:28:29.000Z" title="更新于 2022-05-19 21:28:29">2022-05-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/IT%E9%98%85%E8%AF%BB/">IT阅读</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="GEA-P2"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><h1>1 介绍</h1>
<h2 id="1-6-Runtime-Engine-Architecture">(1.6) Runtime Engine Architecture</h2>
<p><img src="/img/1574738644796.png" alt="Runtime Engine Architecture"></p>
<blockquote>
<p>自底向上的顺序大概为：<br>
硬件层<br>
驱动层<br>
系统层<br>
ＳＤＫ层<br>
＞平台独立层<br>
核心库<br>
资源库<br>
　渲染，调试，物理检测，游戏平台基础<br>
＞游戏级渲染，各上层动画机制，相机机制，ＡＩ机制<br>
＞游戏逻辑层</p>
</blockquote>
<h3 id="操作系统层">操作系统层</h3>
<p>分为PC与主机（游戏）系统，PC系统如windows 提供了一种线程的机制为分享硬件资源，而主机游戏一般来说则可占用所有的硬件资源，但这两者的差距在逐渐减少。</p>
<blockquote>
<p>Operating systems like Microsoft<br>
Windows employ a time-sliced approach to sharing the hardware with multiple running programs, known as preemptive multitasking.<br>
On a console, the game typically<br>
“owns” the entire machine.<br>
So the gap between console and PC development is<br>
gradually closing (for better or for worse).</p>
</blockquote>
<h3 id="3rd-Party-SDKS">3rd Party SDKS</h3>
<blockquote>
<p>DirectX Opengl<br>
Havok, PhysX ODE etc… 实现增强物理效果的SDK<br>
Boost++ C++标准库之一<br>
STL C++标准库之一<br>
Kynapse 游戏AI开发的中间件<br>
Granny, Havok Animation，处理动画骨骼等<br>
Euphoria， 小型的游戏开发套件：<a target="_blank" rel="noopener" href="https://sourceforge.net/projects/euphoriasdk/">https://sourceforge.net/projects/euphoriasdk/</a></p>
</blockquote>
<h4 id="数据结构与算法">数据结构与算法</h4>
<p>C++ 库</p>
<ol>
<li>STL : strings, data structures, stream-based I/O</li>
<li>STLport :portable and optimized of STL</li>
<li>Boost :Powerful data structures and algorithms library</li>
<li>Loki :Powerful generic programming template library</li>
</ol>
<h4 id="图形">图形</h4>
<blockquote>
<p>硬件图形库<br>
Glide  早期的3D图形SDK，针对Voodoo显卡。<br>
OpenGL widely used!<br>
DirectX Microsoft’s 3D graphics SDK<br>
libgcm   更底层的接口针对PS3的图形硬件，OpenGL更高效处理的选择。<br>
Edge Naughty Dog 和Sony提供的PS3平台的库</p>
</blockquote>
<h4 id="物理与碰撞">物理与碰撞</h4>
<blockquote>
<p>Havok industrial-strength physics and collision engine.<br>
PhysX  NVIDIA<br>
Open Dynamics Engine.  open source</p>
</blockquote>
<h4 id="角色动画">角色动画</h4>
<blockquote>
<p>Granny:<br>
In my opinion, the Granny SDK<br>
has the best-designed and most logical animation API of any I’ve seen,<br>
commercial or proprietary, especially its excellent handling of time</p>
</blockquote>
<blockquote>
<p>Havok Animation<br>
The line between physics and animation is becoming<br>
increasingly blurred as characters become more and more realistic.</p>
</blockquote>
<blockquote>
<p>Edge  PS3 from Sony</p>
</blockquote>
<h4 id="生物力学角色模型-Biomechanical-Character-Models">生物力学角色模型 Biomechanical Character Models</h4>
<blockquote>
<p>Endorphin and Euphoria. These are animation packages that produce<br>
character motion using advanced biomechanical models of realistic human movement.<br>
Endorphin, is a Maya plug-in that permits animators to<br>
run full biomechanical simulations on characters and export the resulting animations as if they had been hand animated<br>
Euphoria, is a real-time version of Endorphin intended<br>
to produce physically and biomechanically accurate character motion at runtime under the influence of unpredictable forces.</p>
</blockquote>
<blockquote>
<p>Endorphin， MAYA插件，执行动作的角色将运行一个完整的生物力学模拟同时导出动画。<br>
Euphoria,  在一些不可预测的因素影响下，将动作更精细的模拟表现出来。<br>
<a target="_blank" rel="noopener" href="https://space.bilibili.com/430600560/channel/detail?cid=75669">https://space.bilibili.com/430600560/channel/detail?cid=75669</a></p>
</blockquote>
<h3 id="Platform-Independence-Layer">Platform Independence Layer</h3>
<blockquote>
<p>the platform independence layer ensures consistent<br>
behavior across all hardware platforms.</p>
</blockquote>
<h3 id="Rendering-Engine">Rendering Engine</h3>
<blockquote>
<p>The rendering engine is one of the largest and most complex components of<br>
any game engine.</p>
</blockquote>
<h4 id="Low-Level-Renderer">Low-Level Renderer</h4>
<p><img src="/img/1574756479212.png" alt="Low-Level Renderer"></p>
<blockquote>
<p>Graphics Device Interface<br>
DirectX, OpenGL</p>
</blockquote>
<blockquote>
<p>The low-level renderer usually provides a viewport abstraction with an associated camera-to-world matrix and 3D projection parameters, such as field of view and the location of the near and far clip planes.</p>
</blockquote>
<blockquote>
<p>底层的渲染提供一个显示区域，关联到相机-世界和投影的参数。</p>
</blockquote>
<h4 id="Scene-Graph-Culling-Optimizations">Scene Graph / Culling Optimizations</h4>
<blockquote>
<p>For very small game worlds, a simple frustum cull (i.e., removing objects<br>
that the camera cannot “see”) is probably all that is required. For larger game<br>
worlds, a more advanced spatial subdivision data structure might be used to<br>
improve rendering efficiency by allowing the potentially visible set (PVS) of<br>
objects to be determined very quickly.</p>
</blockquote>
<blockquote>
<p>potentially visible set (PVS)</p>
</blockquote>
<blockquote>
<p>理想状态下，底层渲染应该完全不关心spatial subdivision或scene graph的使用类型。<br>
OGRE open source rendering engine (<a target="_blank" rel="noopener" href="http://www.ogre3d.org">http://www.ogre3d.org</a>) is a great example of this principle in action. OGRE provides a plug-and-play scene graph<br>
architecture. Game developers can either select from a number of preimplemented scene graph designs, or they can provide a custom scene graph implementation.</p>
</blockquote>
<h3 id="Front-End">Front End</h3>
<p><img src="/img/1574759871996.png" alt="Front End"></p>
<blockquote>
<p>HUD, Heads-up Display<br>
在顶层显示<br>
FMV, Full-Motion Video 动作完整的视频回放<br>
This system is responsible for playing full-screen movies that have been recorded earlier.<br>
IGC, in-game cinematics system.  游戏内的视频，一般当玩家不可操作时显示</p>
</blockquote>
<h3 id="Profiling-and-Debugging-Tools">Profiling and Debugging Tools</h3>
<blockquote>
<p>常用<br>
• Intel’s VTune,<br>
• IBM’s Quantify and Purify (part of the PurifyPlus tool suite), and<br>
• Compuware’s Bounds Checker.</p>
</blockquote>
<blockquote>
<p>However, most game engines also incorporate a suite of custom profiling<br>
and debugging tools. For example, they might include one or more of the<br>
following:</p>
<ul>
<li>a mechanism for manually instrumenting the code, so that specific sections of code can be timed;</li>
<li>a facility for displaying the profiling statistics on-screen while the game<br>
is running;</li>
<li>a facility for dumping performance stats to a text file or to an Excel<br>
spreadsheet;</li>
<li>a facility for determining how much memory is being used by the engine, and by each subsystem, including various on-screen displays;</li>
<li>the ability to dump memory usage, high water mark and leakage stats<br>
when the game terminates and/or during gameplay;</li>
<li>tools that allow debug print statements to be peppered throughout the<br>
code, along with an ability to turn on or off different categories of debug<br>
output and control the level of verbosity of the output; and</li>
<li>the ability to record game events and then play them back. This is tough<br>
to get right, but when done properly it can be a very valuable tool for<br>
tracking down bugs.</li>
</ul>
</blockquote>
<h3 id="Collisions-Physics">Collisions &amp; Physics</h3>
<p>Collision and physics are usually quite tightly coupled.</p>
<blockquote>
<ul>
<li>Havok is the gold standard in the industry today. It is feature-rich and<br>
performs well across the boards.</li>
<li>PhysX by NVIDIA is another excellent collision and dynamics engine.<br>
It was integrated into Unreal Engine 4 and is also available for free as<br>
a stand-alone product for PC game development. PhysX was originally<br>
designed as the interface to Ageia’s new physics accelerator chip. The<br>
SDK is now owned and distributed by NVIDIA, and the company has<br>
adapted PhysX to run on its latest GPUs.</li>
</ul>
</blockquote>
<blockquote>
<p>Open source physics and collision engines are also available. Perhaps the best-known of these is the Open Dynamics Engine (ODE)<br>
I-Collide, V-Collide and RAPID are other popular non-commercial collision detection engines. 开发于University of North Carolina<br>
<a target="_blank" rel="noopener" href="http://www.ode.org">http://www.ode.org</a></p>
</blockquote>
<h3 id="Animations">Animations</h3>
<blockquote>
<p>类型：</p>
<ul>
<li>sprite/texture animation,</li>
<li>rigid body hierarchy animation,</li>
<li>skeletal animation, 骨骼动画，</li>
<li>vertex animation， 顶点动画</li>
<li>morph targets.， 拉伸变形目标</li>
</ul>
</blockquote>
<p><img src="/img/1574826629863.png" alt="enter description here"><br>
<img src="/img/1574826985515.png" alt="enter description here"></p>
<h3 id="Human-Interface-Devices-HID">Human Interface Devices (HID)</h3>
<p>input from the player , 玩家的输入设备</p>
<blockquote>
<p>keyboard, mouse<br>
joypad<br>
other specialized game controllers, like steering wheels, fishing rods,<br>
dance pads, the Wiimote, etc.  方向盘，鱼竿，跳舞板，手柄控制器等</p>
</blockquote>
<blockquote>
<p>The HID engine component is sometimes architected to divorce the lowlevel details of the game controller(s) on a particular hardware platform from the high-level game controls.<br>
It sometimes also includes a system for detecting<br>
chords (multiple buttons pressed together), sequences (buttons pressed in sequence within a certain time limit) and gestures (sequences of inputs from the<br>
buttons, sticks, accelerometers, etc.).<br>
HID engine 组件通常设计为划分出低等级的游戏控制器到高级游戏操作。<br>
通常也会考虑检测组合按钮等情况</p>
</blockquote>
<h3 id="Audio">Audio</h3>
<p>Audio engines vary greatly in sophistication.</p>
<blockquote>
<p>For DirectX platforms (PC, Xbox 360, Xbox One), Microsoft provides an excellent audio tool<br>
suite called XACT, supported at runtime by their feature-rich XAudio2 andX3DAudio APIs.</p>
</blockquote>
<blockquote>
<p>Electronic Arts has developed an advanced, high-powered<br>
audio engine internally called SoundR!OT</p>
</blockquote>
<blockquote>
<p>In conjunction with first-party studios like Naughty Dog, Sony Computer Entertainment America (SCEA) provides a powerful 3D audio engine called Scream</p>
</blockquote>
<h3 id="Online-Multiplayer-Networking">Online Multiplayer/Networking</h3>
<blockquote>
<p>That said, it is usually better to design multiplayer features from day one, if you<br>
have that luxury.<br>
尽早设置多人在线的模式</p>
</blockquote>
<blockquote>
<p>从多人在线转单机版，往往较为简单<br>
The Quake engine is well known<br>
for its client-on-top-of-server mode, in which a single executable, running on a<br>
single PC, acts both as the client and the server in single-player campaigns.</p>
</blockquote>
<h3 id="Gameplay-Foundation-Systems">Gameplay Foundation Systems</h3>
<blockquote>
<p>用于连接low-level engine systems 与 gameplay code。为了上层游戏逻辑可以更方便使用。</p>
</blockquote>
<p><img src="/img/1574912330296.png" alt="enter description here"></p>
<h3 id="Game-Worlds-and-Object-Models">Game Worlds and Object Models</h3>
<blockquote>
<p>游戏内的对象：</p>
<ul>
<li>static background geometry, like buildings, roads, terrain (often a special case), etc.;</li>
<li>dynamic rigid bodies, such as rocks, soda cans, chairs, etc.;</li>
<li>player characters (PC);</li>
<li>non-player characters (NPC);</li>
<li>weapons;</li>
<li>projectiles;</li>
<li>vehicles;</li>
<li>lights (which may be present in the dynamic scene at runtime, or only<br>
used for static lighting offline);</li>
<li>cameras;</li>
</ul>
</blockquote>
<h3 id="Scripting-System-Event">Scripting System &amp; Event</h3>
<blockquote>
<p>Many game engines employ a scripting language in order to make development of game-specific gameplay rules and content easier and more rapid.</p>
</blockquote>
<h3 id="Artificial-Intellience-Foundations">Artificial Intellience Foundations</h3>
<p>游戏的人工智能模块，一些游戏引擎已经在引入这一模块到引擎，虽然这并不是引擎模块考虑的。<br>
Kynogon</p>
<blockquote>
<p>A company called Kynogon developed a middleware SDK named Kynapse, which provided much of the low-level technology required to build commercially viable game AI.  This SDK provides low-level AI building blocks such as nav mesh generation, path finding, static and dynamic object avoidance, identification of vulnerabilities within a play space (e.g., an open window from which an ambush could come) and a well-defined interface between AI and animation.</p>
</blockquote>
<h3 id="Game-Specific-Subsystems">Game-Specific Subsystems</h3>
<p>顶端的游戏开发层</p>
<blockquote>
<p>Practically speaking, this line is never perfectly distinct. At least<br>
some game-specific knowledge invariably seeps down through the gameplay<br>
foundations layer and sometimes even extends into the core of the engine<br>
itself.</p>
</blockquote>
<h2 id="1-7-Tools-and-the-asset-pipeline">(1.7) Tools and the asset pipeline</h2>
<p>游戏数据层的组成：<br>
如图：粗黑箭头， 表示源数据是怎样从工具中生成出<br>
细线箭头，表示不同数据资源之间的引用关系<br>
<img src="/img/1574995793894.png" alt="enter description here"></p>
<h3 id="Digital-Content-Creation-Tools">Digital Content Creation Tools</h3>
<p>游戏资源从3D mesh到图片bitmaps再到音频之类的，都需要设计师用工具制作，而这些工具被称为DCC（Digital Content Creation）</p>
<blockquote>
<p>Maya,3d Max<br>
SoundForge<br>
Photoshop<br>
。。。</p>
</blockquote>
<blockquote>
<p>That said, tools must be relatively <strong>easy to use</strong>, and they absolutely must be reliable, if a game team is going to be able to develop a highly polished product in a timely manner.<br>
工具的使用需要按项目所需来决定，关键在于好用，不一定要非常完美的工具。</p>
</blockquote>
<h3 id="The-Asset-Conditioning-Pipeline">The Asset Conditioning Pipeline</h3>
<p>往往DCC生成的文件并不能直接在游戏开发中使用，原因有下：</p>
<ol>
<li>
<p>DCC导出的数据，存在许多游戏开发不需要的，比如maya中会存储directed acyclic graph的场景结点，和复杂的联结的网络结构。</p>
</li>
<li>
<p>DCC文件格式加载读取很慢，而且通常格式是各个DCC专属的</p>
</li>
</ol>
<blockquote>
<p>Once data has been exported from the DCC app, it often must be further<br>
processed before being sent to the game engine. And if a game studio is shipping its game on more than one platform, the intermediate files might be processed differently for each target platform.<br>
DCC应用一般需要生成给游戏引擎用的文件。</p>
</blockquote>
<blockquote>
<p>The pipeline from DCC app to game engine is sometimes called the asset<br>
conditioning pipeline (ACP). Every game engine has this in some form.<br>
这种途径：从DCC应用到游戏引擎通常被称为: ACP</p>
</blockquote>
<h4 id="3D-Model-Mesh-Data">3D Model/Mesh Data</h4>
<blockquote>
<p>A mesh is a complex shape composed of triangles and vertices. A mesh typically has one or more materials applied to it in order to define<br>
visual surface properties<br>
MESH：由三角面和点组成的复杂的形状</p>
</blockquote>
<blockquote>
<p>In this book, I will use the term “mesh” to refer to a single renderable shape,<br>
and “model” to refer to a composite object that may contain multiple meshes,<br>
plus animation data and other metadata for use by the game.</p>
</blockquote>
<blockquote>
<p>Brush Geometry<br>
Brush geometry is defined as a collection of convex hulls, each of which is defined by multiple planes.Brushes are typically created and edited directly in the game world editor. This is essentially an “old school” approach to creating<br>
renderable geometry, but it is still used in some engines.<br>
笔刷型的图形，每个都由多个平面组成，通常是凹凸面的一种实现工具。<br>
Pros:<br>
• fast and easy to create;<br>
• accessible to game designers—often used to “block out” a game level for<br>
prototyping purposes;<br>
• can serve both as collision volumes and as renderable geometry.<br>
Cons:<br>
• low-resolution;<br>
• difficult to create complex shapes;<br>
• cannot support articulated objects or animated characters.</p>
</blockquote>
<h4 id="Skeletal-Animation-Data">Skeletal Animation Data</h4>
<p>A skeletal mesh is a special kind of mesh that is bound to a skeletal hierarchy for<br>
the purposes of articulated animation.</p>
<blockquote>
<p>Each vertex of a skeletal mesh contains a list of indices indicating to which<br>
joint(s) in the skeleton it is bound. A vertex usually also includes a set of joint<br>
weights, specifying the amount of influence each joint has on the vertex.<br>
骨骼mesh，包含骨骼连接点信息，通常还会有点的权重和数量影响的数据</p>
</blockquote>
<blockquote>
<p>In order to render a skeletal mesh, the game engine requires three distinct<br>
kinds of data:</p>
<ol>
<li>the mesh itself,</li>
<li>the skeletal hierarchy (joint names, parent-child relationships and the<br>
base pose the skeleton was in when it was originally bound to the mesh),<br>
and58 1. Introduction</li>
<li>one or more animation clips, which specify how the joints should move<br>
over time.</li>
</ol>
</blockquote>
<blockquote>
<p>Mesh与skeleton通常由DCC导出在一个文件里，当然，当有多个mesh对应一个骨骼时，骨骼通常需要单独导出，另外动画文件一般也是单独导出。有些引擎会让这三者在一个大文件里。</p>
</blockquote>
<blockquote>
<p>An unoptimized skeletal animation is defined by a stream of 4 × 3 matrix<br>
samples, taken at a frequency of at least 30 frames per second, for each of the<br>
joints in a skeleton (of which there can be 500 or more for a realistic humanoid<br>
character).<br>
因此动画文件一般需要使用高强度的压缩方式来存储。</p>
</blockquote>
<h4 id="Audio-Data">Audio Data</h4>
<p>Audio clips are usually exported from Sound Forge or some other audio production tool in a variety of formats and at a number of different data sampling rates.</p>
<h4 id="Particle-Systems-Data">Particle Systems Data</h4>
<p>Modern games make use of complex particle effects. These are authored by<br>
artists who specialize in the creation of visual effects. Third-party tools, such<br>
as Houdini, permit film-quality effects to be authored</p>
<h3 id="The-World-Editor">The World Editor</h3>
<p>The game world is where everything in a game engine comes together. To my<br>
knowledge, there are no commercially available game world editors</p>
<blockquote>
<ul>
<li>Some variant of the Radiant game editor is used by most game engines<br>
based on Quake technology.</li>
<li>The Half-Life 2 Source engine provides a world editor called Hammer.</li>
<li>UnrealEd is the Unreal Engine’s world editor. This powerful tool also<br>
serves as the asset manager for all data types that the engine can consume.</li>
</ul>
</blockquote>
<h3 id="The-Resource-Database">The Resource Database</h3>
<p>Every asset also carries with it a great deal of metadata. metadata with the following information:<br>
• A unique id that identifies the animation clip at runtime.<br>
• The name and directory path of the source Maya (.ma or .mb) file.<br>
• The frame range—on which frame the animation begins and ends.<br>
• Whether or not the animation is intended to loop.<br>
• The animator’s choice of compression technique and level. (Some assets<br>
can be highly compressed without noticeably degrading their quality,<br>
while others require less or no compression in order to look right ingame.)</p>
<h3 id="Some-Approaches-to-Tool-Architecture">Some Approaches to Tool Architecture</h3>
<p>As an interesting and unique example, Unreal’s world editor and asset<br>
manager, UnrealEd, is built right into the runtime game <a target="_blank" rel="noopener" href="http://engine.It">engine.It</a> permits the tools to<br>
have total access to the full range of data structures used by the engine and<br>
avoids a common problem of having to have two representations of every<br>
data structure—one for the runtime engine and one for the tools.</p>
<blockquote>
<p>运行时编辑和访问游戏所有数据为开发带来便利和加速</p>
</blockquote>
<p><img src="/img/1575083811284.png" alt="一些游戏的工具架构"><br>
<img src="/img/1575083796324.png" alt="一些运行时可编辑的架构"></p>
<h4 id="Web-Based-User-Interfaces">Web-Based User Interfaces</h4>
<p>网页基础的页面显示。这里主要指工具。</p>
<blockquote>
<p>At Naughty Dog, we use a number of web-based<br>
UIs. Naughty Dog’s localization tool serves as the front-end portal into our<br>
localization database. Tasker is the web-based interface used by all Naughty<br>
Dog employees to create, manage, schedule, communicate and collaborate on<br>
game development tasks during production. A web-based interface known<br>
as Connector also serves as our window into the various streams of debugging<br>
information that are emitted by the game engine at runtime.</p>
</blockquote>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Game/">Game</a></div><div class="post_share"><div class="social-share" data-image="/img/1574738644796.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/weixin.jpg" target="_blank"><img class="post-qr-code-img" src="/img/weixin.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/19/GEA_P1/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">GEA-P1</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/19/GEA_P3/"><img class="next-cover" src="/./img/1575255814499.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">GEA-P3</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/05/19/GEA_P1/" title="GEA-P1"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-19</div><div class="title">GEA-P1</div></div></a></div><div><a href="/2022/05/19/GEA_P3/" title="GEA-P3"><img class="cover" src="/./img/1575255814499.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-19</div><div class="title">GEA-P3</div></div></a></div><div><a href="/2022/05/19/GEA_P4/" title="GEA-P4"><img class="cover" src="/img/1599634350864.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-19</div><div class="title">GEA-P4</div></div></a></div><div><a href="/2022/05/19/IT-English/" title="Game Engine Architecture - English"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-19</div><div class="title">Game Engine Architecture - English</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/my.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">霍家鹏</div><div class="author-info__description">Keep going. Keep study.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">88</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/AveryHuo"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/AveryHuo" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:jackhamsir@sina.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">HI, 这是我的博客空间</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">1 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-Runtime-Engine-Architecture"><span class="toc-number">1.1.</span> <span class="toc-text">(1.6) Runtime Engine Architecture</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%B1%82"><span class="toc-number">1.1.1.</span> <span class="toc-text">操作系统层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3rd-Party-SDKS"><span class="toc-number">1.1.2.</span> <span class="toc-text">3rd Party SDKS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">数据结构与算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">图形</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%A9%E7%90%86%E4%B8%8E%E7%A2%B0%E6%92%9E"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">物理与碰撞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E5%8A%A8%E7%94%BB"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">角色动画</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E7%89%A9%E5%8A%9B%E5%AD%A6%E8%A7%92%E8%89%B2%E6%A8%A1%E5%9E%8B-Biomechanical-Character-Models"><span class="toc-number">1.1.2.5.</span> <span class="toc-text">生物力学角色模型 Biomechanical Character Models</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Platform-Independence-Layer"><span class="toc-number">1.1.3.</span> <span class="toc-text">Platform Independence Layer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rendering-Engine"><span class="toc-number">1.1.4.</span> <span class="toc-text">Rendering Engine</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Low-Level-Renderer"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">Low-Level Renderer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scene-Graph-Culling-Optimizations"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">Scene Graph &#x2F; Culling Optimizations</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Front-End"><span class="toc-number">1.1.5.</span> <span class="toc-text">Front End</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Profiling-and-Debugging-Tools"><span class="toc-number">1.1.6.</span> <span class="toc-text">Profiling and Debugging Tools</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Collisions-Physics"><span class="toc-number">1.1.7.</span> <span class="toc-text">Collisions &amp; Physics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Animations"><span class="toc-number">1.1.8.</span> <span class="toc-text">Animations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Human-Interface-Devices-HID"><span class="toc-number">1.1.9.</span> <span class="toc-text">Human Interface Devices (HID)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Audio"><span class="toc-number">1.1.10.</span> <span class="toc-text">Audio</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Online-Multiplayer-Networking"><span class="toc-number">1.1.11.</span> <span class="toc-text">Online Multiplayer&#x2F;Networking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gameplay-Foundation-Systems"><span class="toc-number">1.1.12.</span> <span class="toc-text">Gameplay Foundation Systems</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Game-Worlds-and-Object-Models"><span class="toc-number">1.1.13.</span> <span class="toc-text">Game Worlds and Object Models</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scripting-System-Event"><span class="toc-number">1.1.14.</span> <span class="toc-text">Scripting System &amp; Event</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Artificial-Intellience-Foundations"><span class="toc-number">1.1.15.</span> <span class="toc-text">Artificial Intellience Foundations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Game-Specific-Subsystems"><span class="toc-number">1.1.16.</span> <span class="toc-text">Game-Specific Subsystems</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-Tools-and-the-asset-pipeline"><span class="toc-number">1.2.</span> <span class="toc-text">(1.7) Tools and the asset pipeline</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Digital-Content-Creation-Tools"><span class="toc-number">1.2.1.</span> <span class="toc-text">Digital Content Creation Tools</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Asset-Conditioning-Pipeline"><span class="toc-number">1.2.2.</span> <span class="toc-text">The Asset Conditioning Pipeline</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3D-Model-Mesh-Data"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">3D Model&#x2F;Mesh Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Skeletal-Animation-Data"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">Skeletal Animation Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Audio-Data"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">Audio Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Particle-Systems-Data"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">Particle Systems Data</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-World-Editor"><span class="toc-number">1.2.3.</span> <span class="toc-text">The World Editor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Resource-Database"><span class="toc-number">1.2.4.</span> <span class="toc-text">The Resource Database</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Some-Approaches-to-Tool-Architecture"><span class="toc-number">1.2.5.</span> <span class="toc-text">Some Approaches to Tool Architecture</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Web-Based-User-Interfaces"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">Web-Based User Interfaces</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2019/05/13/GitNote/" title="Git Note"><img src="/img/1573879504277.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git Note"/></a><div class="content"><a class="title" href="/2019/05/13/GitNote/" title="Git Note">Git Note</a><time datetime="2022-07-13T07:01:05.000Z" title="更新于 2022-07-13 15:01:05">2022-07-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/19/CGNote1/" title="计算机图形学编程笔记1"><img src="/img/16088048947285131.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机图形学编程笔记1"/></a><div class="content"><a class="title" href="/2022/05/19/CGNote1/" title="计算机图形学编程笔记1">计算机图形学编程笔记1</a><time datetime="2022-07-12T10:02:18.000Z" title="更新于 2022-07-12 18:02:18">2022-07-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/12/UECastawayProject/" title="UE5 Castaway项目记录"><img src="/img/160880488888801.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="UE5 Castaway项目记录"/></a><div class="content"><a class="title" href="/2022/07/12/UECastawayProject/" title="UE5 Castaway项目记录">UE5 Castaway项目记录</a><time datetime="2022-07-12T08:15:27.000Z" title="更新于 2022-07-12 16:15:27">2022-07-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/05/19/UE5Newbie/" title="UE5初入">UE5初入</a><time datetime="2022-07-12T07:52:50.000Z" title="更新于 2022-07-12 15:52:50">2022-07-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/25/CGAssignmentsNote/" title="GAMES101作业笔记"><img src="/img/160880489472852501.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GAMES101作业笔记"/></a><div class="content"><a class="title" href="/2022/05/25/CGAssignmentsNote/" title="GAMES101作业笔记">GAMES101作业笔记</a><time datetime="2022-06-30T02:34:25.000Z" title="更新于 2022-06-30 10:34:25">2022-06-30</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2022 By 霍家鹏</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn"><img class="icp-icon" src="icp图片"><span>粤ICP备2020091327号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>